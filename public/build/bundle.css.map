{
  "version": 3,
  "sources": ["Map.svelte"],
  "sourcesContent": ["<script>\n    import Map from \"@arcgis/core/Map\";\n    import MapView from \"@arcgis/core/views/MapView\";\n    import esriConfig from \"@arcgis/core/config\";\n    import FeatureLayer from \"@arcgis/core/layers/FeatureLayer\";\n    import GraphicsLayer from \"@arcgis/core/layers/GraphicsLayer\";\n    import Graphic from \"@arcgis/core/Graphic\";\n    import {solve} from \"@arcgis/core/rest/route\";\n    import RouteParameters from \"@arcgis/core/rest/support/RouteParameters\";\n    import FeatureSet from \"@arcgis/core/rest/support/FeatureSet\";\n    import {fetchServiceDescription} from \"@arcgis/core/rest/networkService\";\n\n    import { addFeatures } from '@esri/arcgis-rest-feature-layer';\n    import Point from \"@arcgis/core/geometry/Point\";\n\n\n\n    import {onMount} from 'svelte';\n   \n\n    esriConfig.apiKey = \"AAPK3ace7928316549b28c33b66ea457e676dbsV_3c1DDacVuVpeGLLORLCTguTWMzszmAq_TwOPq10LjIj__CNgFsd1GDFUUHa\";\n\n    const simpleFillUGC = {\n                type: \"simple-fill\",\n                color: [227, 139, 79, 0.8],  // Orange, opacity 80%\n                outline: {\n                    color: [255, 255, 255],\n                    width: 1\n                }\n            };\n\n    const map = new Map({\n        basemap: \"arcgis-navigation\" //Basemap layer service\n    });\n\n    const flBarrier = new FeatureLayer({\n        portalItem: { // autocasts as esri/portal/PortalItem\n          id: \"ab54728e3c794d588a4ea1720db8d10e\"\n        }\n    });\n\n    const flUGC = new FeatureLayer({\n        portalItem: {\n          id: \"81d73c02a70d4aae83fc7c3ba0f073a7\"\n        },\n        renderer: {\n            type: \"simple\",\n            symbol: simpleFillUGC\n        }\n    });\n\n    const graphicsLayer = new GraphicsLayer();\n    \n    map.add(graphicsLayer);\n    map.add(flBarrier); \n    map.add(flUGC); \n\n    const routeUrl = \"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World\";\n\n\n    onMount(async ()=>{\n        const serviceDescription = await fetchServiceDescription(routeUrl);\n        const { supportedTravelModes } = serviceDescription;\n        const travelMode = supportedTravelModes.find((mode) => mode.name === \"Walking Time\");\n\n        const barriers = await flBarrier.queryFeatures();\n\n        const view = new MapView({\n            container: \"viewDiv\",\n            map: map,\n            center: [8.51631, 47.38935], //Longitude, latitude\n            zoom: 14\n        });\n\n        view.on(\"hold\",async (event) => {\n\n            const y1 = event.mapPoint.latitude-0.00005;\n            const y2 = event.mapPoint.latitude+0.00005;\n            const x1 = event.mapPoint.longitude-0.00005;\n            const x2 = event.mapPoint.longitude+0.00005;\n\n            const rings = [[x1,y1],[x2,y1],[x2,y2],[x1,y2],[x1,y1]];\n\n            const result = await addFeatures({\n                url: 'https://services8.arcgis.com/VAHmVwXyn8lMPYKG/arcgis/rest/services/flood_ugc/FeatureServer/0',\n                features: [{\n                    attributes: {\n                        type: 'local flood'\n                    },\n                    geometry: {\n                        \"rings\": [rings],\n                        \"spatialReference\": {\n                            \"wkid\": 4326\n                        }\n                    }\n                }]\n            });\n\n\n            const polygon = {\n                type: \"polygon\",\n                rings: rings\n            };\n\n            \n\n            const polygonGraphic = new Graphic({\n                geometry: polygon,\n                symbol: simpleFillUGC,\n            });\n\n            graphicsLayer.add(polygonGraphic);\n\n            console.log(rings)\n\n        })\n\n        view.on(\"click\", function(event) {\n            if (view.graphics.length === 0) {\n                addGraphic(\"origin\", event.mapPoint);\n            } else if (view.graphics.length === 1) {\n                addGraphic(\"destination\", event.mapPoint);\n                getRoute(); // Call the route service\n            } else {\n                view.graphics.removeAll();\n                addGraphic(\"origin\", event.mapPoint);\n            }\n        });\n\n        function addGraphic(type, point) {\n            const graphic = new Graphic({\n            symbol: {\n                type: \"simple-marker\",\n                color: (type === \"origin\") ? \"white\" : \"black\",\n                size: \"8px\"\n            },\n            geometry: point\n            });\n            view.graphics.add(graphic);\n        }\n\n        async function getRoute() {\n            console.log(barriers);\n            const routeParams = new RouteParameters({\n                stops: new FeatureSet({\n                    features: view.graphics.toArray()\n                }),\n                polygonBarriers: barriers,\n                travelMode\n            });\n            const data = await solve(routeUrl, routeParams);\n\n            data.routeResults.forEach(function(result) {\n                result.route.symbol = {\n                    type: \"simple-line\",\n                    color: [5, 150, 255],\n                    width: 3\n                };\n\n                view.graphics.add(result.route);\n            });\n                \n        }\n    });\n</script>\n\n<div id=\"viewDiv\"></div>\n\n<style>\n    @import \"https://js.arcgis.com/4.21/@arcgis/core/assets/esri/themes/dark/main.css\";\n    div{\n        height:100%;\n        width: 100%;\n    }\n</style>"],
  "mappings": ";;;AA0KI;AACI;AACA;;",
  "names": []
}
